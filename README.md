# Sauce Orchestrate Workshop

This workshop provides practical exercises and example workflows for Sauce Orchestrate.

- Before starting.
  - [Install Visual Code](https://code.visualstudio.com/docs/setup/setup-overview). 
  - Run this command  
  `docker image pull --platform linux/amd64 suncup/photon-js:latest`
  - [Install the latest release of `saucectl`](https://docs.saucelabs.com/dev/cli/saucectl/#installing-saucectl).

- During the workshop.
  - Explain your answers.  
  - Describe your thought process.


---

### Module 1


#### 1.1 Inspect
- Inspect the `saucectl` configuration file listed below.  
  [`.sauce/config-module-01.yml`](.sauce/config-module-01.yml)
  - What environment variables does it expect?
    - Make sure you have all the environment variables specified set.
  - What image does it use?


#### 1.2 Run
- Run run `saucectl` command below. 
  - Describe what happened.
  - If successful, what did it do?
  - If unsuccessful, what does the error message say?
    - What does that mean?
    - How do you fix it?
  - What is a runID?


```
saucectl run --config .sauce/config-module-01.yml
```

---


### Module 2

#### 2.1 Inspect

- Inspect the `saucectl` configuration file listed below.  
  [`.sauce/config-module-02-01.yml`](.sauce/config-module-02-01.yml)  
  - Describe what it does.  


#### 2.2 Run
- Run run `saucectl` command below.
  - Describe what happened.
  - If successful, what did it do?
  - If unsuccessful, what does the error message say?
    - What does that mean?
    - How do you fix it?
    - What is the runID?
      - Write it down here.


```
saucectl run --config .sauce/config-module-02-01.yml
```


#### 2.2 Artifacts 
- Collect the error from the container.
  - Update the configuration file to download the error log.
  - Read about the configuration key named [artifacts](https://docs.saucelabs.com/orchestrate/saucectl-configuration/#artifacts).
  - Make a copy of the existing configuration and add the needed key to save a custom artifact.
    - We want to collect the error log that was referenced in the console output.

> This same configuration can be used to download custom reports or test artifacts that are written to the container.

```
saucectl run --config .sauce/config-module-02-02.yml
```

#### 2.3 Download
- Re-run with the new configuration.
  - Where is the file?
    - Use the runID to download the file locally to inspect. <!-- copy the runID from the previous runner output, type export and then double click the runID in the cosole and do a copy/paste, less typing here, it should be fast -->  
  `export runID=b1ba17a21fdf4941933cf5cbe95f548d`

```
saucectl imagerunner artifacts download ${runID} "*" --target-dir artifacts/${runID} --region ${SAUCE_REGION}
```

#### 2.4 Logs
- What does the log from the container tell us?
  - Is this different than what the log from `saucectl` told us?
  - Pull the console output for this run from `saucectl`.
    - Confirm the answer needed was not already provided.
      <!-- if you didn't export the runID then the next command will not work -->

```
saucectl imagerunner logs ${runID} 
```


#### 2.5 Triage
- Where is the issue with the test?
  - How can we triage this issue further?
  - Can you collect all the available paths from the image? 
  - Create a new configuration file.
    - This time change the entry point to run the command listed below.  
`env`

```
saucectl run --config .sauce/config-module-02-05-01.yml
```

  - Try the command below next.  
    - Run this new configuration.
    - What output do you collect?
    - What does this tell you?
    - Have you confirmed what the issue is?
    - Do you now think the issue is related to something else?  
`ls -la demo-webdriverio`

```
saucectl run --config .sauce/config-module-02-05-02.yml
```

  - What if the output was truncated? <!-- it isn't, probably, I dunno -->
  - What about running a script with multiple commands? <!-- this is just an example of what is possible. it is useful to understand all the other bits -->
    - Update the configuration to send the output to a log.
    - Update the configuration to automatically download the log.
  


```
saucectl run --config .sauce/config-module-02-05-03.yml
```

  - What did this configuration file do?
    - Did we update the image? <!-- no, we don't have access to the image -->
    - Will the script be there if I run a different configuration? <!-- only if you include the files key as listed -->
    - Where are the logs generated by this script downloaded? <!-- that is controlled by the artifacts key -->
    - Does it matter where I place the artifacts key in the runner configuration? <!-- yes, if it is a child of a suite it defines which artifacts to save from the container, if at the top level of the runner configuration it is to control when to download the artifacts -->
    - I added the artifacts key and it is not download the job assets? Where is the video? Where is the console log? <!-- The runner configuration only manages the Sauce Orchestrate container. This what the runID is for. Use the existing tools to query the jobID. Yes saucectl can download job artifacts as well -->


---


### Module 3

Up to this point...
- We have not used Docker.
- We have not built an image.  
- We have not looked at a DOCKER file.

Let's do the same investigation directly on the image.
This provides us with an interactive session and will save a lot of time.
What if you don't have access to the image?

Keep everything as close as possible to the original configuration.  
Use the same variables passed in the `saucectl` configuration file.


#### Part I


- Run the command below.
  
```
# use this image
export imageName='suncup/photon-js:latest'

# start a shell
docker run -it \
    --platform linux/amd64 \
    --env SAUCE_USERNAME=${SAUCE_USERNAME} \
    --env SAUCE_ACCESS_KEY=${SAUCE_ACCESS_KEY} \
    --env SAUCE_REGION=${SAUCE_REGION} \
    --env SAUCE_BUILD_TYPE="Docker Local Dev" \
    ${imageName} \
    sh
```

- Where are you? <!-- the container -->
- What can you fix? <!-- you can update the entrypoint in the runner configuration -->

#### Part II

- Go through all the steps from Module 2 in this interactive session.
  - Is the [`get-info.sh`](usr/get-info.sh) script there? <!-- no it is not, the runner configuration overlayed the file in that specific container. the file does not exist on the image -->
  - What did you find?


#### Part III

- Get the test to run directly from the container.
  - What should the _entrypoint_ be? 
  - Fix it and re-run via `saucectl`.



```
saucectl run --config .sauce/config-module-03-01.yml
```

#### Part IV 

- What is the one thing needed to run these commands? <!-- access to the image -->
- What are you able to fix, change, or update? <!-- still only the entrypoint and other parts of the the runner configuration. -->


---


## Congratulations!

You have completed the _first_ part of this workshop!

<br>

## Next Up

### Step 2 
  - Reasearch any blockers that you hit.
  - Walkthrough the entire workshop a 2nd time by yourself.
    - Go through all the modules in order.
    - Execute all the commands.
    - Explain your answers.
    - Describe your thought process.
    - All the notes are in this file as HTML comments <!-- see -->
    - Send feedback! <!-- please, thank you! >
  - Supplement this workshop with [The Missing Semester](https://missing.csail.mit.edu/).

<br> 

### Step 3
  - Host this workshop for a colleague.
    - Walk them through the entire workshop.
    - This will help you become a better guide to others.
    - If they are blocked...
      - Provide the solution and explain it.
      - Direct them to the exact command needed to move on to the next step.
      - If they cannot drive further, share your screen and complete the workshop.
    - All the notes are in this file as HTML comments <!-- see -->
    - Send feedback! <!-- please, thank you! >



<br>

---

## Appendix Other Commands

```
docker history --human --format "{{.CreatedBy}}: {{.Size}}" ${imageName}
docker diff # compare two images
```

```
# https://github.com/wagoodman/dive
dive ${imageName}
```

